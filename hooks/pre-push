#!/bin/bash

# --- Hook pre-push pour bloquer le push si des erreurs d√©tect√©es ---

SCRIPT_PATH="scripts/review_mailer.py"

# Email de l'auteur du commit
RECIPIENT_EMAIL=$(git log -1 --pretty=format:'%ae')

# Tous les fichiers staged pour le push
CHANGED_FILES=$(git diff --cached --name-only | paste -sd "," -)

# Ex√©cution du script Python
python3 "$SCRIPT_PATH" "$RECIPIENT_EMAIL" "$CHANGED_FILES"

EXIT_CODE=$?
if [ $EXIT_CODE -ne 0 ]; then
    echo "üö´ Push annul√© : des erreurs de code ont √©t√© d√©tect√©es."
    exit 1
fi

exit 0
